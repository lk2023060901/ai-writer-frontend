# 聊天界面布局修复实施计划

- [x] 1. 修复 ChatMessages 组件滚动问题
  - 重构 ChatMessages 组件的容器结构，使用明确的高度约束和滚动区域
  - 优化消息列表的渲染和滚动行为
  - 确保自动滚动到最新消息功能正常工作
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 1.1 重构 ChatMessages 容器结构
  - 修改 ChatMessages 组件的最外层容器，移除 `flex flex-col gap-6` 布局
  - 创建独立的滚动容器，使用 `h-full overflow-y-auto` 样式
  - 将建议区域和消息区域分离为独立的滚动单元
  - _需求: 1.1, 1.2_

- [x] 1.2 优化消息渲染和间距
  - 调整消息之间的间距，使用 padding 而非 margin 来避免滚动问题
  - 确保消息内容在滚动容器内正确渲染
  - 优化长消息的换行和显示效果
  - _需求: 1.2, 1.5_

- [x] 1.3 修复自动滚动行为
  - 改进 `messagesEndRef.current?.scrollIntoView()` 的调用时机
  - 添加滚动行为的防抖处理，避免频繁滚动
  - 确保新消息和流式消息都能正确触发自动滚动
  - _需求: 1.3, 1.4_

- [x] 2. 修复 ChatInput 附件上传布局变形
  - 重构 ChatInput 组件的附件预览区域，使用固定高度避免布局变形
  - 优化输入框的高度变化处理
  - 确保附件上传不影响消息区域的布局
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 2.1 重构附件预览区域
  - 为附件预览区域设置固定高度 (60px)
  - 使用 `flex-shrink: 0` 确保预览区域不会被压缩
  - 优化附件预览的内容布局和样式
  - _需求: 2.1, 2.3_

- [x] 2.2 优化输入框高度变化处理
  - 限制 textarea 的最大高度，避免过度扩展
  - 添加平滑的高度变化动画
  - 确保高度变化不影响父容器的布局
  - _需求: 2.2, 2.6_

- [x] 2.3 改进附件上传交互
  - 优化附件上传按钮的视觉反馈
  - 改进附件删除功能，确保删除后布局恢复正常
  - 添加附件上传状态的视觉指示
  - _需求: 2.4, 2.5_

- [x] 3. 优化聊天页面整体布局结构
  - 重构 ChatPage 组件的布局，确保各区域有明确的高度约束
  - 优化响应式布局，确保在不同屏幕尺寸下的稳定性
  - 添加布局相关的 CSS 样式和工具类
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.1 重构 ChatPage 布局结构
  - 修改聊天区域的 Flexbox 布局，确保消息容器有正确的高度计算
  - 为消息容器添加 `overflow: hidden` 以创建滚动上下文
  - 确保输入区域使用 `flex-shrink: 0` 保持固定高度
  - _需求: 3.1, 3.2_

- [x] 3.2 添加布局相关的 CSS 样式
  - 在 globals.css 中添加聊天布局相关的工具类
  - 创建自定义滚动条样式，提升视觉体验
  - 添加响应式布局的媒体查询规则
  - _需求: 3.4, 3.5_

- [x] 3.3 优化响应式布局
  - 测试并优化不同屏幕尺寸下的布局表现
  - 确保移动端的滚动和输入体验
  - 添加必要的断点和布局调整
  - _需求: 2.5, 3.4_

- [x] 4. 添加布局测试和验证
  - 创建布局相关的单元测试
  - 添加滚动行为的集成测试
  - 验证不同浏览器的兼容性
  - _需求: 所有需求的验证_

- [x] 4.1 创建 ChatMessages 组件测试
  - 测试滚动行为是否正常工作
  - 测试自动滚动到底部功能
  - 测试消息渲染和更新
  - _需求: 1.1, 1.2, 1.3_

- [x] 4.2 创建 ChatInput 组件测试
  - 测试附件上传和删除功能
  - 测试输入框高度变化
  - 测试布局稳定性
  - _需求: 2.1, 2.2, 2.3, 2.4_

- [x] 4.3 添加布局集成测试
  - 测试整体聊天页面的布局稳定性
  - 测试响应式布局在不同屏幕尺寸下的表现
  - 验证滚动和输入交互的流畅性
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_